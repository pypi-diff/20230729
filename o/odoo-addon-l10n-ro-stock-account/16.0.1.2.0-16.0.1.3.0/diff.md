# Comparing `tmp/odoo_addon_l10n_ro_stock_account-16.0.1.2.0-py3-none-any.whl.zip` & `tmp/odoo_addon_l10n_ro_stock_account-16.0.1.3.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,57 +1,58 @@
-Zip file size: 67059 bytes, number of entries: 55
--rw-r--r--  2.0 unx     3436 b- defN 23-Jul-23 12:12 odoo/addons/l10n_ro_stock_account/README.rst
--rw-r--r--  2.0 unx       79 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/__init__.py
--rw-r--r--  2.0 unx     1198 b- defN 23-Jul-23 12:12 odoo/addons/l10n_ro_stock_account/__manifest__.py
--rw-r--r--  2.0 unx    12467 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/init_hook.py
--rw-r--r--  2.0 unx    16065 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/i18n/l10n_ro_stock_account.pot
--rw-r--r--  2.0 unx    17146 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/i18n/ro.po
--rw-r--r--  2.0 unx      434 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/models/__init__.py
--rw-r--r--  2.0 unx      588 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/models/account_account.py
--rw-r--r--  2.0 unx     6119 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/models/account_move.py
--rw-r--r--  2.0 unx      419 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/models/l10n_ro_stock_valuation_layer_tracking.py
--rw-r--r--  2.0 unx     3176 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/models/product_category.py
--rw-r--r--  2.0 unx    16503 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/models/product_product.py
--rw-r--r--  2.0 unx     3103 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/models/product_template.py
--rw-r--r--  2.0 unx      655 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/models/res_company.py
--rw-r--r--  2.0 unx    10102 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/models/stock_landed_cost.py
--rw-r--r--  2.0 unx     1428 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/models/stock_location.py
--rw-r--r--  2.0 unx    31057 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/models/stock_move.py
--rw-r--r--  2.0 unx     1668 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/models/stock_move_line.py
--rw-r--r--  2.0 unx     1334 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/models/stock_picking.py
--rw-r--r--  2.0 unx     1108 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/models/stock_quant.py
--rw-r--r--  2.0 unx     8827 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/models/stock_valuation_layer.py
--rw-r--r--  2.0 unx      303 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/readme/CONTRIBUTORS.rst
--rw-r--r--  2.0 unx       95 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/readme/DESCRIPTION.rst
--rw-r--r--  2.0 unx      197 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/security/ir.model.access.csv
--rw-r--r--  2.0 unx      566 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/static/description/icon.png
--rw-r--r--  2.0 unx    12854 b- defN 23-Jul-23 12:12 odoo/addons/l10n_ro_stock_account/static/description/index.html
--rw-r--r--  2.0 unx      367 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/tests/__init__.py
--rw-r--r--  2.0 unx    23813 b- defN 23-Jul-23 12:12 odoo/addons/l10n_ro_stock_account/tests/common.py
--rw-r--r--  2.0 unx     4873 b- defN 23-Jul-23 12:12 odoo/addons/l10n_ro_stock_account/tests/common2.py
--rw-r--r--  2.0 unx     9814 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/tests/test_consum.py
--rw-r--r--  2.0 unx     2074 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/tests/test_inventory.py
--rw-r--r--  2.0 unx     3741 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/tests/test_po_landed_cost_sale.py
--rw-r--r--  2.0 unx     3729 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/tests/test_po_sale_landed_cost.py
--rw-r--r--  2.0 unx      760 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/tests/test_product.py
--rw-r--r--  2.0 unx     3745 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/tests/test_purchase.py
--rw-r--r--  2.0 unx     1932 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/tests/test_reception_return_not_fifo.py
--rw-r--r--  2.0 unx      515 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/tests/test_retur.py
--rw-r--r--  2.0 unx     5707 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/tests/test_sale.py
--rw-r--r--  2.0 unx     5202 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/tests/test_svl_vacuum_location.py
--rw-r--r--  2.0 unx      675 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/views/account_account_view.xml
--rw-r--r--  2.0 unx     1403 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/views/product_category_view.xml
--rw-r--r--  2.0 unx      892 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/views/product_template_view.xml
--rw-r--r--  2.0 unx      922 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/views/stock_landed_cost_view.xml
--rw-r--r--  2.0 unx     1998 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/views/stock_location_view.xml
--rw-r--r--  2.0 unx     1989 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/views/stock_picking_view.xml
--rw-r--r--  2.0 unx     3778 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/views/stock_valuation_layer_views.xml
--rw-r--r--  2.0 unx       83 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/wizard/__init__.py
--rw-r--r--  2.0 unx     1316 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/wizard/stock_picking_return.py
--rw-r--r--  2.0 unx     1362 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/wizard/stock_picking_return_views.xml
--rw-r--r--  2.0 unx     1102 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/wizard/stock_valuation_layer_revaluation.py
--rw-r--r--  2.0 unx      936 b- defN 23-Jul-23 12:11 odoo/addons/l10n_ro_stock_account/wizard/stock_valuation_layer_revaluation_views.xml
--rw-r--r--  2.0 unx     4192 b- defN 23-Jul-23 12:12 odoo_addon_l10n_ro_stock_account-16.0.1.2.0.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Jul-23 12:12 odoo_addon_l10n_ro_stock_account-16.0.1.2.0.dist-info/WHEEL
--rw-r--r--  2.0 unx        5 b- defN 23-Jul-23 12:12 odoo_addon_l10n_ro_stock_account-16.0.1.2.0.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     6350 b- defN 23-Jul-23 12:12 odoo_addon_l10n_ro_stock_account-16.0.1.2.0.dist-info/RECORD
-55 files, 244294 bytes uncompressed, 56285 bytes compressed:  77.0%
+Zip file size: 68847 bytes, number of entries: 56
+-rw-r--r--  2.0 unx     3436 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/README.rst
+-rw-r--r--  2.0 unx       79 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/__init__.py
+-rw-r--r--  2.0 unx     1198 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/__manifest__.py
+-rw-r--r--  2.0 unx    12467 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/init_hook.py
+-rw-r--r--  2.0 unx    16253 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/i18n/l10n_ro_stock_account.pot
+-rw-r--r--  2.0 unx    17146 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/i18n/ro.po
+-rw-r--r--  2.0 unx      434 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/models/__init__.py
+-rw-r--r--  2.0 unx      588 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/models/account_account.py
+-rw-r--r--  2.0 unx     6119 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/models/account_move.py
+-rw-r--r--  2.0 unx      419 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/models/l10n_ro_stock_valuation_layer_tracking.py
+-rw-r--r--  2.0 unx     3176 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/models/product_category.py
+-rw-r--r--  2.0 unx    16577 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/models/product_product.py
+-rw-r--r--  2.0 unx     3103 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/models/product_template.py
+-rw-r--r--  2.0 unx      655 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/models/res_company.py
+-rw-r--r--  2.0 unx    10102 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/models/stock_landed_cost.py
+-rw-r--r--  2.0 unx     1428 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/models/stock_location.py
+-rw-r--r--  2.0 unx    34408 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/models/stock_move.py
+-rw-r--r--  2.0 unx     1668 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/models/stock_move_line.py
+-rw-r--r--  2.0 unx     1334 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/models/stock_picking.py
+-rw-r--r--  2.0 unx     1108 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/models/stock_quant.py
+-rw-r--r--  2.0 unx     8934 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/models/stock_valuation_layer.py
+-rw-r--r--  2.0 unx      303 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/readme/CONTRIBUTORS.rst
+-rw-r--r--  2.0 unx       95 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/readme/DESCRIPTION.rst
+-rw-r--r--  2.0 unx      197 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/security/ir.model.access.csv
+-rw-r--r--  2.0 unx      566 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/static/description/icon.png
+-rw-r--r--  2.0 unx    12854 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/static/description/index.html
+-rw-r--r--  2.0 unx      407 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/tests/__init__.py
+-rw-r--r--  2.0 unx    23813 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/tests/common.py
+-rw-r--r--  2.0 unx     4873 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/tests/common2.py
+-rw-r--r--  2.0 unx     9814 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/tests/test_consum.py
+-rw-r--r--  2.0 unx     2074 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/tests/test_inventory.py
+-rw-r--r--  2.0 unx     3741 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/tests/test_po_landed_cost_sale.py
+-rw-r--r--  2.0 unx     3729 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/tests/test_po_sale_landed_cost.py
+-rw-r--r--  2.0 unx      760 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/tests/test_product.py
+-rw-r--r--  2.0 unx     3745 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/tests/test_purchase.py
+-rw-r--r--  2.0 unx     1932 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/tests/test_reception_return_not_fifo.py
+-rw-r--r--  2.0 unx      515 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/tests/test_retur.py
+-rw-r--r--  2.0 unx     5707 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/tests/test_sale.py
+-rw-r--r--  2.0 unx     6495 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/tests/test_sale_return_not_fifo.py
+-rw-r--r--  2.0 unx     5202 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/tests/test_svl_vacuum_location.py
+-rw-r--r--  2.0 unx      675 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/views/account_account_view.xml
+-rw-r--r--  2.0 unx     1403 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/views/product_category_view.xml
+-rw-r--r--  2.0 unx      892 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/views/product_template_view.xml
+-rw-r--r--  2.0 unx      922 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/views/stock_landed_cost_view.xml
+-rw-r--r--  2.0 unx     1998 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/views/stock_location_view.xml
+-rw-r--r--  2.0 unx     1989 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/views/stock_picking_view.xml
+-rw-r--r--  2.0 unx     3778 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/views/stock_valuation_layer_views.xml
+-rw-r--r--  2.0 unx       83 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/wizard/__init__.py
+-rw-r--r--  2.0 unx     1316 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/wizard/stock_picking_return.py
+-rw-r--r--  2.0 unx     1362 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/wizard/stock_picking_return_views.xml
+-rw-r--r--  2.0 unx     1102 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/wizard/stock_valuation_layer_revaluation.py
+-rw-r--r--  2.0 unx      936 b- defN 23-Jul-29 06:46 odoo/addons/l10n_ro_stock_account/wizard/stock_valuation_layer_revaluation_views.xml
+-rw-r--r--  2.0 unx     4192 b- defN 23-Jul-29 06:46 odoo_addon_l10n_ro_stock_account-16.0.1.3.0.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Jul-29 06:46 odoo_addon_l10n_ro_stock_account-16.0.1.3.0.dist-info/WHEEL
+-rw-r--r--  2.0 unx        5 b- defN 23-Jul-29 06:46 odoo_addon_l10n_ro_stock_account-16.0.1.3.0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     6475 b- defN 23-Jul-29 06:46 odoo_addon_l10n_ro_stock_account-16.0.1.3.0.dist-info/RECORD
+56 files, 254674 bytes uncompressed, 57861 bytes compressed:  77.3%
```

## zipnote {}

```diff
@@ -108,14 +108,17 @@
 
 Filename: odoo/addons/l10n_ro_stock_account/tests/test_retur.py
 Comment: 
 
 Filename: odoo/addons/l10n_ro_stock_account/tests/test_sale.py
 Comment: 
 
+Filename: odoo/addons/l10n_ro_stock_account/tests/test_sale_return_not_fifo.py
+Comment: 
+
 Filename: odoo/addons/l10n_ro_stock_account/tests/test_svl_vacuum_location.py
 Comment: 
 
 Filename: odoo/addons/l10n_ro_stock_account/views/account_account_view.xml
 Comment: 
 
 Filename: odoo/addons/l10n_ro_stock_account/views/product_category_view.xml
@@ -147,20 +150,20 @@
 
 Filename: odoo/addons/l10n_ro_stock_account/wizard/stock_valuation_layer_revaluation.py
 Comment: 
 
 Filename: odoo/addons/l10n_ro_stock_account/wizard/stock_valuation_layer_revaluation_views.xml
 Comment: 
 
-Filename: odoo_addon_l10n_ro_stock_account-16.0.1.2.0.dist-info/METADATA
+Filename: odoo_addon_l10n_ro_stock_account-16.0.1.3.0.dist-info/METADATA
 Comment: 
 
-Filename: odoo_addon_l10n_ro_stock_account-16.0.1.2.0.dist-info/WHEEL
+Filename: odoo_addon_l10n_ro_stock_account-16.0.1.3.0.dist-info/WHEEL
 Comment: 
 
-Filename: odoo_addon_l10n_ro_stock_account-16.0.1.2.0.dist-info/top_level.txt
+Filename: odoo_addon_l10n_ro_stock_account-16.0.1.3.0.dist-info/top_level.txt
 Comment: 
 
-Filename: odoo_addon_l10n_ro_stock_account-16.0.1.2.0.dist-info/RECORD
+Filename: odoo_addon_l10n_ro_stock_account-16.0.1.3.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## odoo/addons/l10n_ro_stock_account/__manifest__.py

```diff
@@ -1,11 +1,11 @@
 # License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl.html).
 {
     "name": "Romania - Stock Accounting",
-    "version": "16.0.1.2.0",
+    "version": "16.0.1.3.0",
     "category": "Localization",
     "summary": "Romania - Stock Accounting",
     "author": "NextERP Romania,"
     "Dorin Hongu,"
     "Forest and Biomass Romania,"
     "Odoo Community Association (OCA)",
     "website": "https://github.com/OCA/l10n-romania",
```

## odoo/addons/l10n_ro_stock_account/i18n/l10n_ro_stock_account.pot

```diff
@@ -146,14 +146,19 @@
 
 #. module: l10n_ro_stock_account
 #: model:ir.model.fields,field_description:l10n_ro_stock_account.field_stock_return_picking_line__l10n_ro_origin_ret_move_qty_warn
 msgid "L10N Ro Origin Ret Move Qty Warn"
 msgstr ""
 
 #. module: l10n_ro_stock_account
+#: model:ir.model.fields,field_description:l10n_ro_stock_account.field_stock_valuation_layer__l10n_ro_qty_returned
+msgid "L10N Ro Qty Returned"
+msgstr ""
+
+#. module: l10n_ro_stock_account
 #: model:ir.model.fields,field_description:l10n_ro_stock_account.field_l10n_ro_stock_valuation_layer_tracking____last_update
 msgid "Last Modified on"
 msgstr ""
 
 #. module: l10n_ro_stock_account
 #: model:ir.model.fields,field_description:l10n_ro_stock_account.field_l10n_ro_stock_valuation_layer_tracking__write_uid
 msgid "Last Updated by"
```

## odoo/addons/l10n_ro_stock_account/models/product_product.py

```diff
@@ -383,7 +383,11 @@
         product = self.with_company(company.id)
         if product.cost_method == "average" and not float_is_zero(
             product.quantity_svl, precision_rounding=self.uom_id.rounding
         ):
             product.sudo().with_context(disable_auto_svl=True).write(
                 {"standard_price": product.value_svl / product.quantity_svl}
             )
+
+    # _svl_empty_stock din 15.0 ?
+
+    # _svl_replenish_stock din 15.0 ?
```

## odoo/addons/l10n_ro_stock_account/models/stock_move.py

```diff
@@ -135,15 +135,15 @@
                     svl_vals = move.product_id._prepare_in_svl_vals(
                         forced_quantity or valued_quantity, unit_cost
                     )
                     svl_vals.update(move._prepare_common_svl_vals())
                     svl_vals.update(
                         {
                             "l10n_ro_stock_move_line_id": valued_move_line.id,
-                            "tracking": tracking,
+                            "l10n_ro_tracking": tracking,
                         }
                     )
                     if forced_quantity:
                         svl_vals["description"] = (
                             "Correction of %s (modification of past move)"
                             % move.picking_id.name
                             or move.name
@@ -266,16 +266,99 @@
             self.is_l10n_ro_record
             and self.location_id.usage == "customer"
             and self._is_in()
         )
         return it_is
 
     def _create_delivery_return_svl(self, forced_quantity=None):
+        # move = self.with_context(standard=True, valued_type="delivery_return")
+        # return move._create_in_svl(forced_quantity)
+
         move = self.with_context(standard=True, valued_type="delivery_return")
-        return move._create_in_svl(forced_quantity)
+
+        if not move.origin_returned_move_id.sudo().stock_valuation_layer_ids:
+            return move._create_in_svl(forced_quantity)
+
+        _logger.debug("SVL:delivery_return")
+        svls = self.env["stock.valuation.layer"]
+        l10n_ro_records = move.filtered("is_l10n_ro_record")
+        if self - l10n_ro_records:
+            svls = super(StockMove, self - l10n_ro_records)._create_in_svl(
+                forced_quantity
+            )
+
+        # For Romania, create a valuation layer for each stock move line
+        for move in l10n_ro_records:
+            move = move.with_company(move.company_id)
+
+            out_svls = []
+            origin_svls = (
+                move.origin_returned_move_id.sudo().stock_valuation_layer_ids.sorted(
+                    lambda l: l.create_date, reverse=False
+                )
+            )
+            for svl in origin_svls:
+                out_svls.append(
+                    {
+                        "product_id": svl.product_id.id,
+                        "quantity": -1 * svl.quantity - svl.l10n_ro_qty_returned,
+                        "unit_cost": abs(svl.unit_cost),
+                        "svl_id": svl.id,
+                        "svl": svl,
+                    }
+                )
+
+            valued_move_lines = move._get_in_move_lines()
+            if not valued_move_lines and forced_quantity:
+                svls |= move._create_in_svl(forced_quantity)
+                continue
+
+            for valued_move_line in valued_move_lines:
+                move = move.with_context(stock_move_line_id=valued_move_line)
+                valued_quantity = valued_move_line.product_uom_id._compute_quantity(
+                    valued_move_line.qty_done, move.product_id.uom_id
+                )
+
+                for out_svl in out_svls:
+                    if out_svl["quantity"] <= 0:
+                        continue
+                    if valued_quantity <= 0:
+                        break
+
+                    if valued_quantity > out_svl["quantity"]:
+                        quantity = out_svl["quantity"]
+                    else:
+                        quantity = valued_quantity
+
+                    out_svl["quantity"] -= quantity
+                    out_svl["svl"].l10n_ro_qty_returned += quantity
+                    valued_quantity -= quantity
+
+                    unit_cost = out_svl["unit_cost"]
+                    tracking = [
+                        (
+                            out_svl["svl_id"],
+                            quantity,
+                            unit_cost * quantity,
+                        )
+                    ]
+
+                    if move.product_id.cost_method == "standard":
+                        unit_cost = move.product_id.standard_price
+                    svl_vals = move.product_id._prepare_in_svl_vals(quantity, unit_cost)
+                    svl_vals.update(move._prepare_common_svl_vals())
+                    svl_vals.update(
+                        {
+                            "l10n_ro_stock_move_line_id": valued_move_line.id,
+                            "l10n_ro_tracking": tracking,
+                        }
+                    )
+
+                    svls |= self._l10n_ro_create_track_svl([svl_vals])
+        return svls
 
     def _is_plus_inventory(self):
         it_is = (
             self.is_l10n_ro_record
             and self.location_id.usage == "inventory"
             and self.location_dest_id.usage == "internal"
         )
@@ -408,15 +491,15 @@
                     new_svl_vals.update(
                         {
                             "quantity": abs(svl_vals.get("quantity", 0)),
                             "remaining_qty": abs(svl_vals.get("quantity", 0)),
                             "unit_cost": abs(svl_vals.get("unit_cost", 0)),
                             "value": abs(svl_vals.get("value", 0)),
                             "remaining_value": abs(svl_vals.get("value", 0)),
-                            "tracking": [
+                            "l10n_ro_tracking": [
                                 (
                                     svls[-1].id,
                                     abs(svl_vals.get("quantity", 0)),
                                     abs(svl_vals.get("value", 0)),
                                 )
                             ],
                         }
```

## odoo/addons/l10n_ro_stock_account/models/stock_valuation_layer.py

```diff
@@ -60,14 +60,16 @@
         string="Romania - Source Valuation",
     )
     l10n_ro_svl_src_ids = fields.Many2many(
         "stock.valuation.layer",
         compute="_compute_l10n_ro_svl_tracking",
         string="Romania - Destination Valuation",
     )
+    # cantitate returnata dintr-o iesire
+    l10n_ro_qty_returned = fields.Float()
 
     @api.depends("product_id", "account_move_id")
     def _compute_account(self):
         for svl in self.filtered(lambda sv: sv.stock_move_id.is_l10n_ro_record):
             account = self.env["account.account"]
             svl = svl.with_company(svl.stock_move_id.company_id)
 
@@ -168,28 +170,28 @@
                 (6, 0, s.l10n_ro_svl_track_src_ids.mapped("svl_src_id").ids)
             ]
 
     @api.model
     def _l10n_ro_pre_process_value(self, value):
         """
         Pentru a mapa tracking pe SVL in value pastram o cheie
-        'tracking': [(svl_id, qty).....]
+        'l10n_ro_tracking': [(svl_id, qty).....]
         inainte sa executam .create() curatam dictionarul.
         """
         fields_dict = self._fields.keys()
         return {
             svl_key: svl_value
             for svl_key, svl_value in value.items()
             if svl_key in fields_dict
         }
 
     def _l10n_ro_post_process(self, value):
         """
-        Pentru a mapa tracking pe SVL in value pastram o cheie
-        'tracking': [(svl_id, qty).....]
+        Pentru a mapa l10n_ro_tracking pe SVL in value pastram o cheie
+        'l10n_ro_tracking': [(svl_id, qty).....]
         acum este momentul sa mapam sursa, destinatia si cantitatea.
         """
 
         if value.get("l10n_ro_tracking", None):
             self._l10n_ro_create_tracking(value.get("l10n_ro_tracking"))
 
     def _l10n_ro_tracking_merge_value(self, svl_id, quantity, value):
```

## odoo/addons/l10n_ro_stock_account/tests/__init__.py

```diff
@@ -9,7 +9,8 @@
 from . import test_inventory
 
 from . import test_consum
 from . import test_reception_return_not_fifo
 from . import test_svl_vacuum_location
 from . import test_po_sale_landed_cost
 from . import test_po_landed_cost_sale
+from . import test_sale_return_not_fifo
```

## Comparing `odoo_addon_l10n_ro_stock_account-16.0.1.2.0.dist-info/METADATA` & `odoo_addon_l10n_ro_stock_account-16.0.1.3.0.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: odoo-addon-l10n-ro-stock-account
-Version: 16.0.1.2.0
+Version: 16.0.1.3.0
 Summary: Romania - Stock Accounting
 Home-page: https://github.com/OCA/l10n-romania
 Author: NextERP Romania,Dorin Hongu,Forest and Biomass Romania,Odoo Community Association (OCA)
 Author-email: support@odoo-community.org
 License: AGPL-3
 Platform: UNKNOWN
 Classifier: Programming Language :: Python
```

## Comparing `odoo_addon_l10n_ro_stock_account-16.0.1.2.0.dist-info/RECORD` & `odoo_addon_l10n_ro_stock_account-16.0.1.3.0.dist-info/RECORD`

 * *Files 7% similar despite different names*

```diff
@@ -1,55 +1,56 @@
 odoo/addons/l10n_ro_stock_account/README.rst,sha256=VaVE274MyzphetZRCuPHVsMLWyolDgBHyPQwT87Jb8s,3436
 odoo/addons/l10n_ro_stock_account/__init__.py,sha256=PacuDFh1zPYOcR8_TpqCbSm2lburCBebCib46Rga4LY,79
-odoo/addons/l10n_ro_stock_account/__manifest__.py,sha256=MPhlUjbZWVR-c97D_fJ-a8RWLMMjrwPuuh021ok0UyU,1198
+odoo/addons/l10n_ro_stock_account/__manifest__.py,sha256=xLHSJoBYVAd80rUCHgVc-Tt2y7bYhD0YMeaLdNnJzh4,1198
 odoo/addons/l10n_ro_stock_account/init_hook.py,sha256=ALTW5wQKBLJr82YYMpSgX51t2N5fb_RTWttPNOEdKt8,12467
-odoo/addons/l10n_ro_stock_account/i18n/l10n_ro_stock_account.pot,sha256=KzaIGpe9QU0C_Y7FCo8Pj8LrAEmmrjronWfuocMgyBg,16065
+odoo/addons/l10n_ro_stock_account/i18n/l10n_ro_stock_account.pot,sha256=7ArJ9tHp5m5MeEnY3EOGUuFr-m07-JZ-OzrmXh8cv9s,16253
 odoo/addons/l10n_ro_stock_account/i18n/ro.po,sha256=4UggMC2pdTEXdMy5x-T6jhplklZUEAEE0bjFPuTnGuA,17146
 odoo/addons/l10n_ro_stock_account/models/__init__.py,sha256=GV7G2YF21G_xjW7QmrViek6VP-bpFPv8FXB5EFvzoFQ,434
 odoo/addons/l10n_ro_stock_account/models/account_account.py,sha256=VWfu4nKGYWPIdk-N-Sf-mNJwdGNdLCrkTLMHSp5V_MA,588
 odoo/addons/l10n_ro_stock_account/models/account_move.py,sha256=G6W90kcfGyT9-jGKvjXNCq99UflXwI63iip2COaYftw,6119
 odoo/addons/l10n_ro_stock_account/models/l10n_ro_stock_valuation_layer_tracking.py,sha256=uCieonqwP4C2kEM0I2M7il96Y_vstmXzUn4W0zc9cuo,419
 odoo/addons/l10n_ro_stock_account/models/product_category.py,sha256=96rcY4AMPHB4lax0iXsxgbCo9Yifrp0xX8eT3D40B0I,3176
-odoo/addons/l10n_ro_stock_account/models/product_product.py,sha256=6qpggTGCMz3jjCDlSR8nDCcQ4pPW3ysLQr_AOju_Wac,16503
+odoo/addons/l10n_ro_stock_account/models/product_product.py,sha256=581BP63B8F9Q9TG5MdNw-qDnblRIxn8lnIijTEKitXg,16577
 odoo/addons/l10n_ro_stock_account/models/product_template.py,sha256=ou3I7vS4gMpSUeB3irVUgyB11YDGrD5fkw1XM8u4sWw,3103
 odoo/addons/l10n_ro_stock_account/models/res_company.py,sha256=N96-mE6HqZ-nM027UBNbTmxzxxf9rsOsrudv-_lQ7RA,655
 odoo/addons/l10n_ro_stock_account/models/stock_landed_cost.py,sha256=tMnuufgYOBks7RnX0Y9RUoZ6UqXcQJQWh9D5YFEWwIM,10102
 odoo/addons/l10n_ro_stock_account/models/stock_location.py,sha256=ufg27uLVP3UxfKmTyHx5vixp5UQSjwGDevxOhyhY5Z8,1428
-odoo/addons/l10n_ro_stock_account/models/stock_move.py,sha256=QnubYUQ9iwl6uBBBJb7ONI_96zLPQsTHQSyzkTYy0I8,31057
+odoo/addons/l10n_ro_stock_account/models/stock_move.py,sha256=3P-34UjnZOLzuQ5Xqy6f0durg9VRgBIPfVZLKNP_J5g,34408
 odoo/addons/l10n_ro_stock_account/models/stock_move_line.py,sha256=ZtBZOrOS5V9qlGJksTTAdPalZ70naOINyU5NOrDj0WQ,1668
 odoo/addons/l10n_ro_stock_account/models/stock_picking.py,sha256=OGNWrnoHDCklDXt5vDzvRCNq-WuKvDQvZIR-oOQSsvI,1334
 odoo/addons/l10n_ro_stock_account/models/stock_quant.py,sha256=h3ptdjkJspbtSXWtGt0Gx60AXNSUdXjw5khNsI5K7Mo,1108
-odoo/addons/l10n_ro_stock_account/models/stock_valuation_layer.py,sha256=5hSGm7Y_dSOVvlW67G7SjFQbM8s1W7BEDkw72bX_Zxo,8827
+odoo/addons/l10n_ro_stock_account/models/stock_valuation_layer.py,sha256=CgIV75Ovp1_zlafMf-l9cHoKDzFSEl2HI83sg7hUHMQ,8934
 odoo/addons/l10n_ro_stock_account/readme/CONTRIBUTORS.rst,sha256=HYRMiA7qtJA4RIxiyWWIOwbHg8XNaV0ltNZqeCbL1dE,303
 odoo/addons/l10n_ro_stock_account/readme/DESCRIPTION.rst,sha256=IGaYSYZzlaVso6xah4LBOiTvBs5xwi86-abmjCMPV50,95
 odoo/addons/l10n_ro_stock_account/security/ir.model.access.csv,sha256=T0dM-gb3TZsHQjiBa-WgJbrY7Iw597P9eWU6ElDQdNo,197
 odoo/addons/l10n_ro_stock_account/static/description/icon.png,sha256=MND3TYqrnM623pd0tf3WhoHU-3X5Ns6ho-Yz_HcYlTk,566
 odoo/addons/l10n_ro_stock_account/static/description/index.html,sha256=UU8vMOY1T6fEJkNuUCpXXS8vCGbvoQaGBl8_Zm5tgUo,12854
-odoo/addons/l10n_ro_stock_account/tests/__init__.py,sha256=AP7Be8J_o1xUyX66jB7qp3EhSBo76F-OamAdU05Zs3o,367
+odoo/addons/l10n_ro_stock_account/tests/__init__.py,sha256=rO3lnrbDTQYsF830mLICgq9HIj2MsTwPi9T6QN6q338,407
 odoo/addons/l10n_ro_stock_account/tests/common.py,sha256=BWJEz7KPcb1hNo8sqFx5EAqz9VcQ4AxUWBJIVVfxxm0,23813
 odoo/addons/l10n_ro_stock_account/tests/common2.py,sha256=RnbZEw26qDbRV3L_nB0OjsxswTiAldxmGzFG7zAZB9E,4873
 odoo/addons/l10n_ro_stock_account/tests/test_consum.py,sha256=C_zWKivusB1oph_FRhyutDtqtoqjPLBFYE-WKh_mjmY,9814
 odoo/addons/l10n_ro_stock_account/tests/test_inventory.py,sha256=y0j_n9VYi5O5zICDo_QxPunhO_xzpyXFLQ87dS_AZ8g,2074
 odoo/addons/l10n_ro_stock_account/tests/test_po_landed_cost_sale.py,sha256=MHaCk2wTmOIyhMrxXc1XmdheQmYAqXCNIaRwEk82CCY,3741
 odoo/addons/l10n_ro_stock_account/tests/test_po_sale_landed_cost.py,sha256=5kOzlEXZFfjoso_Xjr_D7EqyvwWYWNnGkbB5hjcVyRo,3729
 odoo/addons/l10n_ro_stock_account/tests/test_product.py,sha256=zhA9HlCODIuZpHj7psijmzIliLVgytNxw3RsKkQ3E14,760
 odoo/addons/l10n_ro_stock_account/tests/test_purchase.py,sha256=cCdr5pRS8Hiquo5q7qQ-A_X29cVuSRTSqysC4Hg42pE,3745
 odoo/addons/l10n_ro_stock_account/tests/test_reception_return_not_fifo.py,sha256=_x9emMEa14qIYsC3KPIgehLe_Jn8J88mFDfcxhXMl8k,1932
 odoo/addons/l10n_ro_stock_account/tests/test_retur.py,sha256=gvFJaTQc9-eCv6piYrLYn__jzrljGUMA7hXGEPGlMPQ,515
 odoo/addons/l10n_ro_stock_account/tests/test_sale.py,sha256=sq9MJO4ExfM8W4HJMJDVNrwlnex19UcQns7AWuPvN6M,5707
+odoo/addons/l10n_ro_stock_account/tests/test_sale_return_not_fifo.py,sha256=WTdj5FLYb2o2j73OQYbLxiuSZgAdHhTR0PR3CRPA3PY,6495
 odoo/addons/l10n_ro_stock_account/tests/test_svl_vacuum_location.py,sha256=ILoV7dvIk6ysz3yThXCe4KZTazW_fCrVc82skMzA2bw,5202
 odoo/addons/l10n_ro_stock_account/views/account_account_view.xml,sha256=9ox9pIDx02DKpBYC1kpvkMPV-2qRIemsT_aUQgUJWpw,675
 odoo/addons/l10n_ro_stock_account/views/product_category_view.xml,sha256=dHxapD6dz-0u3-tHaXPDp6ms1ILLgye-jVeRwwKAy_Q,1403
 odoo/addons/l10n_ro_stock_account/views/product_template_view.xml,sha256=o0MJ_XESfIf3tBqQJdbVzoWbqRG5Jsz8vSqDlVfPuq0,892
 odoo/addons/l10n_ro_stock_account/views/stock_landed_cost_view.xml,sha256=I86yEy25teqD61V4ra4FVeLzRno3Zm-wlSJSw9JjAgQ,922
 odoo/addons/l10n_ro_stock_account/views/stock_location_view.xml,sha256=ZpCEvKk7v8liHv4rH29cNLQTRuUMtphS6bqKSHtHZf8,1998
 odoo/addons/l10n_ro_stock_account/views/stock_picking_view.xml,sha256=hGR6lyA7UMbWbH_rWMmkkT6zOYbP1KJxez13i0Ajppw,1989
 odoo/addons/l10n_ro_stock_account/views/stock_valuation_layer_views.xml,sha256=vqQUarM29ms1gFNUevxN7JmWVn9fpiHQvDOol_YldjE,3778
 odoo/addons/l10n_ro_stock_account/wizard/__init__.py,sha256=eIqrPGDGbKIxnJ5ebAsp5fwAQ6LsOh0Z6Dw1z1qERSw,83
 odoo/addons/l10n_ro_stock_account/wizard/stock_picking_return.py,sha256=NLkH1KxO9jv0HC2YbFH02JmRe2IJy8n-ZWESDdTP9pA,1316
 odoo/addons/l10n_ro_stock_account/wizard/stock_picking_return_views.xml,sha256=I9BSaRGK8-xbZZTPUy1XhLzJyAP-ftq-VU-EGOpvbxc,1362
 odoo/addons/l10n_ro_stock_account/wizard/stock_valuation_layer_revaluation.py,sha256=qjrzT91n9pw7LJtfrDrEZ6ddg5T50hMU5Kz24LuET_o,1102
 odoo/addons/l10n_ro_stock_account/wizard/stock_valuation_layer_revaluation_views.xml,sha256=djZXcgpMsRbYgYSUR45SCznU6ycHyyV4tjdwUQDvYOU,936
-odoo_addon_l10n_ro_stock_account-16.0.1.2.0.dist-info/METADATA,sha256=Xtz6eVypQfKx-LEm2Mi8hDSAvWsmA0CrXew8pRFz_mI,4192
-odoo_addon_l10n_ro_stock_account-16.0.1.2.0.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-odoo_addon_l10n_ro_stock_account-16.0.1.2.0.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
-odoo_addon_l10n_ro_stock_account-16.0.1.2.0.dist-info/RECORD,,
+odoo_addon_l10n_ro_stock_account-16.0.1.3.0.dist-info/METADATA,sha256=IF6XhCaSThaGu1W-phP6vBuzcFKfeQ8HVOC4nMwxjaw,4192
+odoo_addon_l10n_ro_stock_account-16.0.1.3.0.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+odoo_addon_l10n_ro_stock_account-16.0.1.3.0.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
+odoo_addon_l10n_ro_stock_account-16.0.1.3.0.dist-info/RECORD,,
```

